(()=>{function t(t){t.preventDefault(),v.length=0,b=!0,h(t)}function e(){y.clearRect(0,0,m.width,m.height),v.length||(y.font="20px Arial",y.fillStyle="black",y.textAlign="center",y.textBaseline="middle",y.fillText("Draw a circle",window.innerWidth/2,60),y.font="10px Arial",y.fillText("Help: https://joat917.github.io/DrawCircle/help.html",window.innerWidth/2,80))}function n(){m.width=window.innerWidth,m.height=window.innerHeight}function i(){if(e(),!(v.length<=1)){y.lineWidth=2,y.lineCap="round",y.strokeStyle="#03c",y.beginPath(),y.moveTo(v[v.length-1].x,v[v.length-1].y);for(const t of v)y.lineTo(t.x,t.y);y.stroke(),y.beginPath()}}function r(t){y.font="20px Arial",y.fillStyle="black",y.textAlign="left",y.textBaseline="middle";let e=Math.max(55-25*Math.log10(t.deviation/t.radius+.0063),0);y.fillText(`direction:  ${t.winding>0?"clockwise":"counterclockwise"}`,20,window.innerHeight-120),y.fillText(`score:  ${e.toFixed(1)}/100 (GPA:${(e>=60?4-.001875*(100-e)**2:0).toFixed(2)}/4.00)`,20,window.innerHeight-100),y.font="14px Arial",y.fillText(`radius:  ${t.radius.toFixed(1)}px`,25,window.innerHeight-83),y.fillText(`deviation:  ${t.deviation.toFixed(1)}px`,25,window.innerHeight-69),y.fillText(`roughness:  ${(100*t.roughIndex).toFixed(2)}%`,25,window.innerHeight-55),y.fillText("developer:  Joat917@github",25,window.innerHeight-41);const n=Math.max(Math.min(300,window.innerWidth-210),10),i=window.innerWidth-20,o=window.innerHeight-90,r=window.innerHeight-10;let l=0;for(let e=1;e<=36;e++)l=Math.max(l,t.spectrum[e]);if(0!==l){y.lineWidth=2,y.lineCap="round",y.fillStyle="#f00",y.strokeStyle="#F00",y.fillText("Spectrum:",Math.max(n-70,10),r),y.beginPath(),y.moveTo(n,r);for(let e=1;e<=36;e++)y.lineTo(e/36*(i-n)+n,r-(r-o)*t.spectrum[e]/l);y.stroke(),y.beginPath();for(let e=1;e<=36;e++)e>=10&&e%3!=0||y.fillText(e,e/36*(i-n)+n,r-(r-o)*t.spectrum[e]/l)}}function l(){b=!1,y.beginPath(),w()}function h(t){if(!b)return;const e=m.getBoundingClientRect();let n,i;"mousemove"===t.type?(n=t.clientX-e.left,i=t.clientY-e.top):"touchmove"===t.type&&(n=t.touches[0].clientX-e.left,i=t.touches[0].clientY-e.top),isFinite(n)&&isFinite(i)&&(v.push({x:n,y:i}),y.lineWidth=2,y.lineCap="round",y.strokeStyle="#03c",y.lineTo(n,i),y.stroke(),y.beginPath(),y.moveTo(n,i))}function a(t,e,n){if(!b&&isFinite(t+e)){y.lineWidth=2,y.lineCap="round",y.strokeStyle="#f00",y.beginPath(),y.moveTo(t-10,e),y.lineTo(t+10,e),y.stroke(),y.moveTo(t,e-10),y.lineTo(t,e+10),y.stroke(),y.lineWidth=1,y.beginPath(),y.moveTo(t+n,e);for(let i=0;i<=2*Math.PI;i+=.02)y.lineTo(t+n*Math.cos(i),e+n*Math.sin(i));y.lineTo(t+n,e),y.stroke(),y.beginPath()}}function s(t,e,n){b||isFinite(t+e+n)&&(y.lineWidth=2,y.lineCap="round",y.strokeStyle="#f00",y.beginPath(),y.moveTo(t,e),y.lineTo(t+30*Math.cos(n),e+30*Math.sin(n)),y.stroke(),y.beginPath(),y.moveTo(t+30*Math.cos(n)-5*Math.cos(n+.7),e+30*Math.sin(n)-5*Math.sin(n+.7)),y.lineTo(t+30*Math.cos(n),e+30*Math.sin(n)),y.lineTo(t+30*Math.cos(n)-5*Math.cos(n-.7),e+30*Math.sin(n)-5*Math.sin(n-.7)),y.stroke(),y.beginPath())}function c(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function u(t){o=0;for(const e of t)o+=e;return o}function f(t,e){return console.assert(e>0),t>=0?t%e:(e- -t%e)%e}function d(t,e){return Math.abs(t-e)<1e-7}function g(t,e){let n=0,i=[0,0];for(let o=0;o<t.length;o++)console.assert(isFinite(i[0])),n+=e[o],i[0]+=e[o]*t[o].x,i[1]+=e[o]*t[o].y;return{x:i[0]/n,y:i[1]/n,powersum:n}}function M(t,e){return 0===e?t>=0?0:Math.PI:e>0?Math.PI/2-Math.atan(t/e):-Math.PI/2-Math.atan(t/e)}function p(t,e){return[M(t.x-e.x,t.y-e.y),c(t,e)]}function x(t=2){const e=[];for(let n=0;n<v.length;n++){e.push(v[n]);const i=f(n+1,v.length),o=c(v[n],v[i]);if(o>t){const r=Math.ceil(o/t),l={x:(v[i].x-v[n].x)/r,y:(v[i].y-v[n].y)/r};for(let t=1;t<r;t++)e.push({x:l.x*t+v[n].x,y:l.y*t+v[n].y})}}v.splice(0),e.forEach(t=>v.push(t))}function w(t=!1){function n(t){return t<-4?t+2*Math.PI:t>4?t-2*Math.PI:t}function o(t){const e=[];for(let n=0;n<v.length;n++)e.push(p(v[n],t));let i=[],o=[];for(let t=0;t<v.length;t++)i.push(e[t][1]),o.push(n(e[f(t+1,v.length)][0]-e[f(t-1,v.length)][0])/Math.PI/4);const r=(()=>{const t=u(o);return d(t,Math.round(t))?Math.round(t):d(t,Math.round(2*t)/2)?Math.round(2*t)/2:t})();if(1!==Math.abs(r))return{winding:r,acceptable:!1,cosfit:NaN,sinfit:NaN};const l=u(o.map(Math.abs)),h=o.map(t=>Math.abs(t)/l);let a=0;for(let t=0;t<v.length;t++)a+=i[t]*h[t];let s=0,c=0;for(let t=0;t<v.length;t++)s+=(i[t]-a)*h[t]*Math.cos(e[t][0]),c+=(i[t]-a)*h[t]*Math.sin(e[t][0]);return{winding:r,acceptable:!0,cosfit:s,sinfit:c}}function l(t){const e=[];for(let n=0;n<v.length;n++)e.push(p(v[n],t));let i=[],o=[];for(let t=0;t<v.length;t++)i.push(e[t][1]),o.push(n(e[f(t+1,v.length)][0]-e[f(t-1,v.length)][0])/Math.PI/4);const r=(()=>{const t=u(o);return d(t,Math.round(t))?Math.round(t):d(t,Math.round(2*t)/2)?Math.round(2*t)/2:t})();if(1!==Math.abs(r))return{winding:r,radius:NaN,deviation:NaN,strechDirection:NaN};const l=u(o.map(Math.abs)),h=o.map(t=>Math.abs(t)/l);let a=0;for(let t=0;t<v.length;t++)a+=i[t]*h[t];let s=0;for(let t=0;t<v.length;t++)s+=(i[t]-a)**2*Math.abs(o[t]);let c=s/l,g={},x=NaN;const w=0,m=360;for(let t=w;t<=m;t++){let n=0,o=0;for(let r=0;r<v.length;r++)n+=(i[r]-a)*h[r]*Math.cos(t*e[r][0]),o+=(i[r]-a)*h[r]*Math.sin(t*e[r][0]);g[t]=(0===t?1:2)*Math.sqrt(n**2+o**2),2===t&&(x=M(n,o))}return(()=>{let t=c;for(let e=1;e<=m;e<<=1)t-=g[e]**2/Math.PI;g[1/0]=t>0?Math.sqrt(t):0})(),{winding:r,radius:a,deviation:Math.sqrt(s),spectrum:g,strechDirection:x/2,roughIndex:g[1/0]/c}}if(v.length<5)return v.splice(0),T.forEach(t=>v.push(t)),v.length<5?void e():w(t=!0);x();const h=(()=>{const t=[];for(let e=0;e<v.length-1;e++)t.push(c(v[e+1],v[e]));t.push(c(v[0],v[v.length-1]));const e=[(t[0]+t[t.length-1])/2];for(let n=0;n<v.length-1;n++)e[n+1]=(t[n]+t[n+1])/2;return g(v,e)})(),m=o(h);if(!m.acceptable)return v.splice(0),T.forEach(t=>v.push(t)),w(t=!0);if(!t&&T.length==v.length){let t=0;for(let e=0;e<v.length;e++)if(!d(T[e].x,v[e].x)||!d(T[e].y,v[e].y)){t=1;break}if(0===t)return}T.splice(0),v.forEach(t=>T.push(t)),i();const y=(t=>{if(!m.acceptable)return{x:NaN,y:NaN};for(let e=0;e<100;e++){let e=o(t);if(d(e.cosfit,0)&&d(e.sinfit,0))return t;if(t={x:t.x+e.cosfit,y:t.y+e.sinfit},!isFinite(t.x)||!isFinite(t.y))return h}return t})(h),b=l(y);a(y.x,y.y,b.radius),s(y.x,y.y,b.strechDirection),s(y.x,y.y,b.strechDirection+Math.PI),r(b)}for(const t of document.querySelectorAll(".loading"))t.remove();const m=document.createElement("canvas");document.body.appendChild(m);const y=m.getContext("2d");let b=!1;const v=[],T=[];m.addEventListener("mousedown",t),m.addEventListener("mousemove",h),m.addEventListener("mouseup",l),m.addEventListener("mouseout",l),window.addEventListener("resize",n),m.addEventListener("touchstart",t),m.addEventListener("touchmove",h),m.addEventListener("touchend",l),n(),e()})();